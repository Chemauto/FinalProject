<?xml version="1.0" encoding="utf-8" ?>
<svg baseProfile="full" height="1200px" version="1.1" width="1600px" xmlns="http://www.w3.org/2000/svg" xmlns:ev="http://www.w3.org/2001/xml-events" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><marker id="arrow" markerHeight="10" markerWidth="10" refX="10" refY="5"><path d="M 0,0 L 10,5 L 0,10 L 2,5 Z" fill="#666" /></marker></defs><rect fill="#FAFAFA" height="1200px" width="1600px" x="0" y="0" /><text font-family="Arial" font-size="22" font-weight="bold" text-anchor="middle" x="800" y="30">FinalProject 数据流详解 - 追击敌人示例</text><text fill="#2C3E50" font-family="Arial" font-size="14" font-weight="bold" x="50" y="70">场景: 使用自适应控制器的追击流程 (enable_adaptive=True)</text><rect fill="#E3F2FD" height="60" rx="5" stroke="#333" stroke-width="1.5" width="150" x="50" y="90" /><text font-family="Arial" font-size="11" font-weight="bold" text-anchor="middle" x="125" y="110">用户输入</text><text fill="#333" font-family="monospace" font-size="7" text-anchor="start" x="125" y="125">"追击敌人"</text><line marker-end="url(#arrow)" stroke="#666" stroke-width="2" x1="200" x2="250" y1="120" y2="120" /><text fill="#666" font-family="Arial" font-size="8" text-anchor="middle" x="225" y="110">自然语言</text><rect fill="#FFF3E0" height="80" rx="5" stroke="#333" stroke-width="1.5" width="150" x="250" y="90" /><text font-family="Arial" font-size="11" font-weight="bold" text-anchor="middle" x="325" y="110">Interactive_Module</text><text fill="#333" font-family="monospace" font-size="7" text-anchor="start" x="325" y="125">interactive.py</text><text fill="#333" font-family="monospace" font-size="7" text-anchor="start" x="325" y="140">加载 enable_adaptive=True</text><text fill="#333" font-family="monospace" font-size="7" text-anchor="start" x="325" y="155">创建 AdaptiveController</text><line marker-end="url(#arrow)" stroke="#666" stroke-width="2" x1="400" x2="480" y1="130" y2="130" /><text fill="#666" font-family="Arial" font-size="8" text-anchor="middle" x="440" y="120">run_pipeline()</text><rect fill="#FFFDE7" height="100" rx="5" stroke="#FFD700" stroke-width="2" width="220" x="480" y="80" /><text font-family="Arial" font-size="11" font-weight="bold" text-anchor="middle" x="590" y="100">★ AdaptiveController</text><text fill="#333" font-family="Arial" font-size="9" text-anchor="middle" x="590" y="115">协调器:</text><text fill="#333" font-family="monospace" font-size="7" text-anchor="start" x="590" y="128">• 高层LLM (规划)</text><text fill="#333" font-family="monospace" font-size="7" text-anchor="start" x="590" y="140">• 低层LLM (执行)</text><text fill="#333" font-family="monospace" font-size="7" text-anchor="start" x="590" y="152">• 执行监控 (检测)</text><text fill="#333" font-family="monospace" font-size="7" text-anchor="start" x="590" y="164">• 任务队列 (管理)</text><line marker-end="url(#arrow)" stroke="#666" stroke-width="2" x1="700" x2="750" y1="130" y2="130" /><text fill="#666" font-family="Arial" font-size="8" text-anchor="middle" x="725" y="120">异步执行</text><text fill="#2C3E50" font-family="Arial" font-size="14" font-weight="bold" x="50" y="230">步骤1: 高层LLM任务规划</text><rect fill="#FFFDE7" height="80" rx="5" stroke="#FFD700" stroke-width="2" width="200" x="50" y="250" /><text font-family="Arial" font-size="11" font-weight="bold" text-anchor="middle" x="150" y="270">★ HighLevelLLM</text><text fill="#333" font-family="monospace" font-size="7" text-anchor="start" x="150" y="285">high_level_llm.py</text><text fill="#333" font-family="monospace" font-size="7" text-anchor="start" x="150" y="300">plan_tasks(user_input)</text><text fill="#333" font-family="monospace" font-size="7" text-anchor="start" x="150" y="315">生成任务序列</text><line marker-end="url(#arrow)" stroke="#666" stroke-width="2" x1="250" x2="300" y1="290" y2="290" /><text fill="#666" font-family="Arial" font-size="8" text-anchor="middle" x="275" y="280">tasks[]</text><rect fill="#FFFDE7" height="80" rx="5" stroke="#FFD700" stroke-width="2" width="200" x="300" y="250" /><text font-family="Arial" font-size="11" font-weight="bold" text-anchor="middle" x="400" y="270">★ TaskQueue</text><text fill="#333" font-family="monospace" font-size="7" text-anchor="start" x="400" y="285">task_queue.py</text><text fill="#333" font-family="monospace" font-size="7" text-anchor="start" x="400" y="300">set_tasks(tasks)</text><text fill="#333" font-family="monospace" font-size="7" text-anchor="start" x="400" y="315">管理任务状态</text><line marker-end="url(#arrow)" stroke="#666" stroke-width="2" x1="500" x2="550" y1="290" y2="290" /><text fill="#666" font-family="Arial" font-size="8" text-anchor="middle" x="525" y="280">get_next()</text><rect fill="#E8F5E9" height="80" rx="5" stroke="#333" stroke-width="1.5" width="180" x="550" y="250" /><text font-family="Arial" font-size="11" font-weight="bold" text-anchor="middle" x="640" y="265">任务列表:</text><text fill="#333" font-family="monospace" font-size="7" text-anchor="start" x="640" y="280">1. 获取敌人位置</text><text fill="#333" font-family="monospace" font-size="7" text-anchor="start" x="640" y="295">2. 追击最近的敌人</text><text fill="#333" font-family="monospace" font-size="7" text-anchor="start" x="640" y="310">状态: PENDING</text><text fill="#2C3E50" font-family="Arial" font-size="14" font-weight="bold" x="50" y="370">步骤2: 执行循环（带监控）</text><rect fill="#FFFDE7" height="80" rx="5" stroke="#FFD700" stroke-width="2" width="200" x="50" y="390" /><text font-family="Arial" font-size="11" font-weight="bold" text-anchor="middle" x="150" y="410">★ ExecutionMonitor</text><text fill="#333" font-family="monospace" font-size="7" text-anchor="start" x="150" y="425">execution_monitor.py</text><text fill="#333" font-family="monospace" font-size="7" text-anchor="start" x="150" y="440">检测超时/卡住/振荡</text><text fill="#333" font-family="monospace" font-size="7" text-anchor="start" x="150" y="455">环境变化检测</text><line marker-end="url(#arrow)" stroke="#666" stroke-width="2" x1="250" x2="300" y1="430" y2="430" /><text fill="#666" font-family="Arial" font-size="8" text-anchor="middle" x="275" y="420">监控</text><rect fill="#FFFDE7" height="80" rx="5" stroke="#FFD700" stroke-width="2" width="200" x="300" y="390" /><text font-family="Arial" font-size="11" font-weight="bold" text-anchor="middle" x="400" y="410">★ LowLevelLLM</text><text fill="#333" font-family="monospace" font-size="7" text-anchor="start" x="400" y="425">low_level_llm.py</text><text fill="#333" font-family="monospace" font-size="7" text-anchor="start" x="400" y="440">execute_task(task)</text><text fill="#333" font-family="monospace" font-size="7" text-anchor="start" x="400" y="455">选择工具 + 生成参数</text><line marker-end="url(#arrow)" stroke="#666" stroke-width="2" x1="500" x2="550" y1="430" y2="430" /><text fill="#666" font-family="Arial" font-size="8" text-anchor="middle" x="525" y="420">工具调用</text><rect fill="#FFF3E0" height="80" rx="5" stroke="#333" stroke-width="1.5" width="200" x="550" y="390" /><text font-family="Arial" font-size="11" font-weight="bold" text-anchor="middle" x="650" y="410">Robot_Module</text><text fill="#333" font-family="monospace" font-size="7" text-anchor="start" x="650" y="425">MCP工具中心</text><text fill="#333" font-family="monospace" font-size="7" text-anchor="start" x="650" y="440">chase.py</text><text fill="#333" font-family="monospace" font-size="7" text-anchor="start" x="650" y="455">get_enemy_positions()</text><line marker-end="url(#arrow)" stroke="#666" stroke-width="2" x1="750" x2="800" y1="430" y2="430" /><text fill="#666" font-family="Arial" font-size="8" text-anchor="middle" x="775" y="420">ROS2</text><rect fill="#E8F5E9" height="80" rx="5" stroke="#333" stroke-width="1.5" width="200" x="800" y="390" /><text font-family="Arial" font-size="11" font-weight="bold" text-anchor="middle" x="900" y="410">ROS2 Topics</text><text fill="#333" font-family="monospace" font-size="7" text-anchor="start" x="900" y="425">/robot/enemies</text><text fill="#333" font-family="monospace" font-size="7" text-anchor="start" x="900" y="440">std_msgs/String</text><text fill="#333" font-family="monospace" font-size="7" text-anchor="start" x="900" y="455">JSON格式</text><text fill="#2C3E50" font-family="Arial" font-size="14" font-weight="bold" x="50" y="530">步骤3: 自适应处理（如果环境变化）</text><g><rect fill="#FFEBEE" height="100" rx="5" stroke="#E74C3C" stroke-width="2" width="300" x="50" y="550" /><text font-family="Arial" font-size="11" font-weight="bold" text-anchor="middle" x="200" y="570">⚠️ 检测到环境变化</text><text fill="#333" font-family="Arial" font-size="9" text-anchor="middle" x="200" y="588">执行监控器检测到:</text><text fill="#333" font-family="monospace" font-size="7" text-anchor="start" x="80" y="603">• 目标物体消失</text><text fill="#333" font-family="monospace" font-size="7" text-anchor="start" x="200" y="603">• 新障碍物出现</text><text fill="#333" font-family="monospace" font-size="7" text-anchor="start" x="320" y="603">• 传感器失效</text><text fill="#333" font-family="monospace" font-size="7" text-anchor="start" x="200" y="623">status = "requires_replanning"</text></g><line marker-end="url(#arrow)" stroke="#E74C3C" stroke-dasharray="5,5" stroke-width="2" x1="350" x2="400" y1="600" y2="600" /><text fill="#666" font-family="Arial" font-size="8" text-anchor="middle" x="375" y="590">触发</text><g><rect fill="#FFFDE7" height="100" rx="5" stroke="#FFD700" stroke-width="2" width="350" x="400" y="550" /><text font-family="Arial" font-size="11" font-weight="bold" text-anchor="middle" x="575" y="570">★ 自动重新规划</text><text fill="#333" font-family="monospace" font-size="7" text-anchor="start" x="575" y="588">high_level_llm.replan_tasks()</text><text fill="#333" font-family="monospace" font-size="7" text-anchor="start" x="575" y="603">分析失败原因 + 环境状态</text><text fill="#333" font-family="monospace" font-size="7" text-anchor="start" x="575" y="618">生成新任务序列</text><text fill="#333" font-family="monospace" font-size="7" text-anchor="start" x="575" y="633">插入到队列前端 (at_front=True)</text></g><g><rect fill="#E8F5E9" height="100" rx="5" stroke="#333" stroke-width="1.5" width="300" x="800" y="550" /><text font-family="Arial" font-size="11" font-weight="bold" text-anchor="middle" x="950" y="570">继续执行</text><text fill="#333" font-family="Arial" font-size="9" text-anchor="middle" x="950" y="588">新任务:</text><text fill="#333" font-family="monospace" font-size="7" text-anchor="start" x="850" y="603">1. 搜索区域</text><text fill="#333" font-family="monospace" font-size="7" text-anchor="start" x="950" y="603">2. 探测环境</text><text fill="#333" font-family="monospace" font-size="7" text-anchor="start" x="1050" y="603">3. 追击新目标</text><text fill="#333" font-family="monospace" font-size="7" text-anchor="start" x="950" y="623">任务队列自动更新</text></g><text fill="#2C3E50" font-family="Arial" font-size="14" font-weight="bold" x="50" y="710">步骤4: 仿真器执行</text><g><rect fill="#FFF3E0" height="120" rx="5" stroke="#333" stroke-width="2" width="1050" x="50" y="730" /><text font-family="Arial" font-size="11" font-weight="bold" text-anchor="middle" x="575" y="750">Sim_Module 仿真执行循环 (60 FPS)</text><text fill="#333" font-family="monospace" font-size="7" text-anchor="start" x="70" y="770">1. robot.update() - 平滑移动到目标位置</text><text fill="#333" font-family="monospace" font-size="7" text-anchor="start" x="70" y="785">2. enemy_manager.update() - 更新所有敌人</text><text fill="#333" font-family="monospace" font-size="7" text-anchor="start" x="70" y="800">3. publish_robot_state(x, y, angle) - 每帧发布到 /robot/state</text><text fill="#333" font-family="monospace" font-size="7" text-anchor="start" x="70" y="815">4. process_action_queue() - 执行命令队列中的动作</text><text fill="#333" font-family="monospace" font-size="7" text-anchor="start" x="70" y="830">5. process_enemy_remove_queue() - 移除敌人后立即发布更新</text><text fill="#333" font-family="monospace" font-size="7" text-anchor="start" x="70" y="845">6. 每180帧 (3秒) → publish_enemy_positions() 发布到 /robot/enemies</text></g></svg>