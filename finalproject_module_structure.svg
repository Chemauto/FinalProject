<?xml version="1.0" encoding="utf-8" ?>
<svg baseProfile="full" height="1000px" version="1.1" width="1400px" xmlns="http://www.w3.org/2000/svg" xmlns:ev="http://www.w3.org/2001/xml-events" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><marker id="arrow" markerHeight="10" markerWidth="10" refX="10" refY="5"><path d="M 0,0 L 10,5 L 0,10 L 2,5 Z" fill="#666" /></marker></defs><rect fill="#FAFAFA" height="1000px" width="1400px" x="0" y="0" /><text font-family="Arial" font-size="22" font-weight="bold" text-anchor="middle" x="700" y="30">FinalProject 模块结构详解</text><text fill="#666" font-family="Arial" font-size="14" text-anchor="middle" x="700" y="50">LLM_Module v2.0 模块化架构</text><rect fill="#FFFDE7" height="400" rx="5" stroke="#FFD700" stroke-width="3" width="1300" x="50" y="100" /><text font-family="Arial" font-size="12" font-weight="bold" text-anchor="middle" x="700" y="125">LLM_Module/ (v2.0 模块化架构)</text><rect fill="#FFF" height="100" rx="3" stroke="#333" stroke-width="1" width="250" x="80" y="150" /><text font-family="Arial" font-size="12" font-weight="bold" text-anchor="middle" x="205" y="165">__init__.py</text><text fill="#333" font-family="monospace" font-size="8" text-anchor="start" x="90" y="180">导出所有模块</text><text fill="#333" font-family="monospace" font-size="8" text-anchor="start" x="90" y="194">• HighLevelLLM, LowLevelLLM</text><text fill="#333" font-family="monospace" font-size="8" text-anchor="start" x="90" y="208">• TaskQueue, ExecutionMonitor</text><text fill="#333" font-family="monospace" font-size="8" text-anchor="start" x="90" y="222">• AdaptiveController, LLMAgent</text><rect fill="#FFF" height="100" rx="3" stroke="#333" stroke-width="1" width="250" x="350" y="150" /><text font-family="Arial" font-size="12" font-weight="bold" text-anchor="middle" x="475" y="165">high_level_llm.py [★新增]</text><text fill="#333" font-family="monospace" font-size="8" text-anchor="start" x="360" y="180">class HighLevelLLM:</text><text fill="#333" font-family="monospace" font-size="8" text-anchor="start" x="360" y="194">  • plan_tasks() - 任务规划</text><text fill="#333" font-family="monospace" font-size="8" text-anchor="start" x="360" y="208">  • replan_tasks() - 重新规划</text><text fill="#333" font-family="monospace" font-size="8" text-anchor="start" x="360" y="222">  • 支持环境状态输入</text><rect fill="#FFF" height="100" rx="3" stroke="#333" stroke-width="1" width="250" x="680" y="150" /><text font-family="Arial" font-size="12" font-weight="bold" text-anchor="middle" x="805" y="165">low_level_llm.py [★新增]</text><text fill="#333" font-family="monospace" font-size="8" text-anchor="start" x="690" y="180">class LowLevelLLM:</text><text fill="#333" font-family="monospace" font-size="8" text-anchor="start" x="690" y="194">  • execute_task() - 任务执行</text><text fill="#333" font-family="monospace" font-size="8" text-anchor="start" x="690" y="208">  • 环境变化检测</text><text fill="#333" font-family="monospace" font-size="8" text-anchor="start" x="690" y="222">  • 工具选择和参数生成</text><rect fill="#FFF" height="100" rx="3" stroke="#333" stroke-width="1" width="250" x="1010" y="150" /><text font-family="Arial" font-size="12" font-weight="bold" text-anchor="middle" x="1135" y="165">task_queue.py [★新增]</text><text fill="#333" font-family="monospace" font-size="8" text-anchor="start" x="1020" y="180">class TaskQueue:</text><text fill="#333" font-family="monospace" font-size="8" text-anchor="start" x="1020" y="194">  • set_tasks() - 设置任务</text><text fill="#333" font-family="monospace" font-size="8" text-anchor="start" x="1020" y="208">  • get_next_task() - 获取下一个</text><text fill="#333" font-family="monospace" font-size="8" text-anchor="start" x="1020" y="222">  • mark_completed/failed() - ...</text><text fill="#333" font-family="monospace" font-size="8" text-anchor="start" x="1020" y="236">  • insert_tasks() - 动态插入任务</text><rect fill="#FFF" height="100" rx="3" stroke="#333" stroke-width="1" width="250" x="80" y="280" /><text font-family="Arial" font-size="12" font-weight="bold" text-anchor="middle" x="205" y="295">execution_monitor.py [★新增]</text><text fill="#333" font-family="monospace" font-size="8" text-anchor="start" x="90" y="310">class ExecutionMonitor:</text><text fill="#333" font-family="monospace" font-size="8" text-anchor="start" x="90" y="324">  • detect_anomaly() - 异常检测</text><text fill="#333" font-family="monospace" font-size="8" text-anchor="start" x="90" y="338">  • 超时/卡住/振荡检测</text><text fill="#333" font-family="monospace" font-size="8" text-anchor="start" x="90" y="352">  • 环境变化监控</text><rect fill="#FFF" height="100" rx="3" stroke="#333" stroke-width="1" width="250" x="350" y="280" /><text font-family="Arial" font-size="12" font-weight="bold" text-anchor="middle" x="475" y="295">adaptive_controller.py [★新增]</text><text fill="#333" font-family="monospace" font-size="8" text-anchor="start" x="360" y="310">class AdaptiveController:</text><text fill="#333" font-family="monospace" font-size="8" text-anchor="start" x="360" y="324">  • run() - 自适应控制循环</text><text fill="#333" font-family="monospace" font-size="8" text-anchor="start" x="360" y="338">  • 协调规划/执行/监控</text><text fill="#333" font-family="monospace" font-size="8" text-anchor="start" x="360" y="352">  • 自动重新规划</text><rect fill="#FFF" height="100" rx="3" stroke="#333" stroke-width="1" width="250" x="680" y="280" /><text font-family="Arial" font-size="12" font-weight="bold" text-anchor="middle" x="805" y="295">llm_core.py [已重构]</text><text fill="#333" font-family="monospace" font-size="8" text-anchor="start" x="690" y="310">class LLMAgent (兼容层):</text><text fill="#333" font-family="monospace" font-size="8" text-anchor="start" x="690" y="324">  • 内部使用新架构</text><text fill="#333" font-family="monospace" font-size="8" text-anchor="start" x="690" y="338">  • 保持向后兼容</text><text fill="#333" font-family="monospace" font-size="8" text-anchor="start" x="690" y="352">  • enable_adaptive 参数</text><rect fill="#FFF" height="100" rx="3" stroke="#333" stroke-width="1" width="250" x="1010" y="280" /><text font-family="Arial" font-size="12" font-weight="bold" text-anchor="middle" x="1135" y="295">prompts/</text><text fill="#333" font-family="monospace" font-size="8" text-anchor="start" x="1020" y="310">planning_prompt_2d.yaml</text><text fill="#333" font-family="monospace" font-size="8" text-anchor="start" x="1020" y="324">  • 规划提示词模板</text><text fill="#333" font-family="monospace" font-size="8" text-anchor="start" x="1020" y="338">  • 动态填充可用技能</text><rect fill="#FFF" height="100" rx="3" stroke="#333" stroke-width="1" width="250" x="80" y="410" /><text font-family="Arial" font-size="12" font-weight="bold" text-anchor="middle" x="205" y="425">核心类:</text><text fill="#333" font-family="monospace" font-size="8" text-anchor="start" x="90" y="440">HighLevelLLM - 高层规划</text><text fill="#333" font-family="monospace" font-size="8" text-anchor="start" x="90" y="454">LowLevelLLM - 低层执行</text><text fill="#333" font-family="monospace" font-size="8" text-anchor="start" x="90" y="468">Task - 任务数据类</text><text fill="#333" font-family="monospace" font-size="8" text-anchor="start" x="90" y="482">TaskStatus - 状态枚举</text><text fill="#333" font-family="monospace" font-size="8" text-anchor="start" x="90" y="496">ExecutionStatus - 执行状态枚举</text><rect fill="#FFF" height="100" rx="3" stroke="#333" stroke-width="1" width="250" x="500" y="410" /><text font-family="Arial" font-size="12" font-weight="bold" text-anchor="middle" x="625" y="425">核心功能:</text><text fill="#333" font-family="monospace" font-size="8" text-anchor="start" x="510" y="440">• 任务队列管理</text><text fill="#333" font-family="monospace" font-size="8" text-anchor="start" x="510" y="454">• 执行监控</text><text fill="#333" font-family="monospace" font-size="8" text-anchor="start" x="510" y="468">• 环境变化检测</text><text fill="#333" font-family="monospace" font-size="8" text-anchor="start" x="510" y="482">• 多级重新规划</text><text fill="#333" font-family="monospace" font-size="8" text-anchor="start" x="510" y="496">• 异常检测</text><rect fill="#FFF" height="100" rx="3" stroke="#333" stroke-width="1" width="250" x="950" y="410" /><text font-family="Arial" font-size="12" font-weight="bold" text-anchor="middle" x="1075" y="425">使用方式:</text><text fill="#333" font-family="monospace" font-size="8" text-anchor="start" x="960" y="440">from LLM_Module import LLMAgen...</text><text fill="#333" font-family="monospace" font-size="8" text-anchor="start" x="960" y="454">agent = LLMAgent(</text><text fill="#333" font-family="monospace" font-size="8" text-anchor="start" x="960" y="468">  api_key="...",</text><text fill="#333" font-family="monospace" font-size="8" text-anchor="start" x="960" y="482">  enable_adaptive=True</text><text fill="#333" font-family="monospace" font-size="8" text-anchor="start" x="960" y="496">)</text><text font-family="Arial" font-size="12" font-weight="bold" text-anchor="middle" x="50" y="550">版本对比: v1.0 vs v2.0</text><rect fill="#E8F5E9" height="200" rx="5" stroke="#4CAF50" stroke-width="2" width="600" x="50" y="580" /><text font-family="Arial" font-size="12" font-weight="bold" text-anchor="middle" x="350" y="600">v1.0 (旧架构)</text><text fill="#333" font-family="monospace" font-size="8" text-anchor="start" x="70" y="620">LLM_Module/</text><text fill="#333" font-family="monospace" font-size="8" text-anchor="start" x="70" y="634">  ├── llm_core.py (单一文件)</text><text fill="#333" font-family="monospace" font-size="8" text-anchor="start" x="70" y="648">  │   • LLMAgent 类</text><text fill="#333" font-family="monospace" font-size="8" text-anchor="start" x="70" y="662">  │   • plan_tasks() - 任务规划</text><text fill="#333" font-family="monospace" font-size="8" text-anchor="start" x="70" y="676">  │   • execute_single_task() - 执行</text><text fill="#333" font-family="monospace" font-size="8" text-anchor="start" x="70" y="690">  │   • run_pipeline() - 完整流程</text><text fill="#333" font-family="monospace" font-size="8" text-anchor="start" x="70" y="704">  └── prompts/</text><text fill="#333" font-family="monospace" font-size="8" text-anchor="start" x="70" y="718">      └── planning_prompt_2d.yaml</text><text fill="#333" font-family="monospace" font-size="8" text-anchor="start" x="70" y="732" /><text fill="#333" font-family="monospace" font-size="8" text-anchor="start" x="70" y="746">特点:</text><text fill="#333" font-family="monospace" font-size="8" text-anchor="start" x="70" y="760">  ✓ 简单直接</text><text fill="#333" font-family="monospace" font-size="8" text-anchor="start" x="70" y="774">  ✗ 无任务队列管理</text><text fill="#333" font-family="monospace" font-size="8" text-anchor="start" x="70" y="788">  ✗ 无执行监控</text><text fill="#333" font-family="monospace" font-size="8" text-anchor="start" x="70" y="802">  ✗ 无环境变化检测</text><text fill="#333" font-family="monospace" font-size="8" text-anchor="start" x="70" y="816">  ✗ 无重新规划机制</text><rect fill="#FFFDE7" height="200" rx="5" stroke="#FFD700" stroke-width="2" width="600" x="750" y="580" /><text font-family="Arial" font-size="12" font-weight="bold" text-anchor="middle" x="1050" y="600">v2.0 (模块化架构)</text><text fill="#333" font-family="monospace" font-size="8" text-anchor="start" x="770" y="620">LLM_Module/</text><text fill="#333" font-family="monospace" font-size="8" text-anchor="start" x="770" y="634">  ├── high_level_llm.py [★]</text><text fill="#333" font-family="monospace" font-size="8" text-anchor="start" x="770" y="648">  ├── low_level_llm.py [★]</text><text fill="#333" font-family="monospace" font-size="8" text-anchor="start" x="770" y="662">  ├── task_queue.py [★]</text><text fill="#333" font-family="monospace" font-size="8" text-anchor="start" x="770" y="676">  ├── execution_monitor.py [★]</text><text fill="#333" font-family="monospace" font-size="8" text-anchor="start" x="770" y="690">  ├── adaptive_controller.py [★]</text><text fill="#333" font-family="monospace" font-size="8" text-anchor="start" x="770" y="704">  ├── llm_core.py (重构)</text><text fill="#333" font-family="monospace" font-size="8" text-anchor="start" x="770" y="718">  └── prompts/</text><text fill="#333" font-family="monospace" font-size="8" text-anchor="start" x="770" y="732" /><text fill="#333" font-family="monospace" font-size="8" text-anchor="start" x="770" y="746">特点:</text><text fill="#333" font-family="monospace" font-size="8" text-anchor="start" x="770" y="760">  ✓ 职责分离 (高层vs低层)</text><text fill="#333" font-family="monospace" font-size="8" text-anchor="start" x="770" y="774">  ✓ 任务队列管理</text><text fill="#333" font-family="monospace" font-size="8" text-anchor="start" x="770" y="788">  ✓ 执行监控</text><text fill="#333" font-family="monospace" font-size="8" text-anchor="start" x="770" y="802">  ✓ 环境变化检测</text><text fill="#333" font-family="monospace" font-size="8" text-anchor="start" x="770" y="816">  ✓ 自适应重新规划</text><text fill="#333" font-family="monospace" font-size="8" text-anchor="start" x="770" y="830">  ✓ 完全向后兼容</text><text font-family="Arial" font-size="12" font-weight="bold" text-anchor="middle" x="50" y="830">升级路径 (无痛升级)</text><rect fill="#E8F5E9" height="80" rx="5" stroke="#4CAF50" stroke-width="2" width="1300" x="50" y="860" /><text fill="#333" font-family="monospace" font-size="8" text-anchor="start" x="80" y="880">步骤1: 旧代码 (继续工作)</text><text fill="#333" font-family="monospace" font-size="8" text-anchor="start" x="300" y="880">  from LLM_Module import LLMAgent</text><text fill="#333" font-family="monospace" font-size="8" text-anchor="start" x="580" y="880">  agent = LLMAgent(api_key="...", prompt_path="...")</text><text fill="#333" font-family="monospace" font-size="8" text-anchor="start" x="800" y="880">  results = agent.run_pipeline(user_input, tools, execute_fn)</text><text fill="#333" font-family="monospace" font-size="8" text-anchor="start" x="1000" y="880" /><text fill="#333" font-family="monospace" font-size="8" text-anchor="start" x="80" y="905">步骤2: 启用新功能 (只需一个参数！)</text><text fill="#333" font-family="monospace" font-size="8" text-anchor="start" x="300" y="905">  from LLM_Module import LLMAgent</text><text fill="#333" font-family="monospace" font-size="8" text-anchor="start" x="580" y="905">  agent = LLMAgent(api_key="...", prompt_path="...", enable_adaptive=True)  # ← 只需添加这个</text><text fill="#333" font-family="monospace" font-size="8" text-anchor="start" x="800" y="905">  results = agent.run_pipeline(user_input, tools, execute_fn)  # 自动支持重新规划</text><text fill="#333" font-family="monospace" font-size="8" text-anchor="start" x="1000" y="905" /><text fill="#333" font-family="monospace" font-size="8" text-anchor="start" x="80" y="930">步骤3: 使用新架构 (完全控制)</text><text fill="#333" font-family="monospace" font-size="8" text-anchor="start" x="300" y="930">  from LLM_Module import AdaptiveController, HighLevelLLM, LowLevelLLM</text><text fill="#333" font-family="monospace" font-size="8" text-anchor="start" x="580" y="930">  controller = AdaptiveController(high_level_llm=..., low_level_llm=...)</text><text fill="#333" font-family="monospace" font-size="8" text-anchor="start" x="800" y="930">  results = asyncio.run(controller.run(...))  # 异步执行，完全控制</text></svg>